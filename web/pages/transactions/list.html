{{ define "title" }} Transações {{ end }}
{{ define "content" }}

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
  <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Transações</h1>
  </div>

  <div class="alert alert-info" role="alert">
    <i data-feather="info"></i>
    As transações representam pagamentos processados através do Stripe Connect.
    Aqui você pode acompanhar todas as vendas e comissões dos seus produtos.
  </div>

  {{if .Transactions}}
  <div class="card">
    <div class="card-header">
      <h5 class="card-title mb-0">Histórico de Transações</h5>
    </div>
    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Data</th>
            <th>Produto</th>
            <th>Valor Total</th>
            <th>Sua Comissão</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          {{range .Transactions}}
          <tr>
            <td>{{.ID}}</td>
            <td>{{.CreatedAt.Format "02/01/2006 15:04"}}</td>
            <td>{{.Purchase.Ebook.Title}}</td>
            <td>{{.GetFormattedTotalAmount}}</td>
            <td>{{.GetFormattedCreatorAmount}}</td>
            <td>
              {{if eq .Status "completed"}}
              <span class="badge bg-success">Concluída</span>
              {{else if eq .Status "pending"}}
                <span class="badge bg-warning">Pendente</span>
                {{else}}
                  <span class="badge bg-danger">Falha</span>
                  {{end}}
            </td>
            <td>
              <a href="/transactions/detail?id={{.ID}}" class="btn btn-sm btn-info">
                <i data-feather="eye"></i> Detalhes
              </a>
            </td>
          </tr>
          {{end}}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Paginação -->
  {{if .Pagination}}
  <nav aria-label="Navegação de página" class="mt-4">
    <ul class="pagination justify-content-center">
      {{if .Pagination.HasPrev}}
      <li class="page-item">
        <a class="page-link" href="/transactions?page={{.Pagination.PrevPage}}">Anterior</a>
      </li>
      {{else}}
        <li class="page-item disabled">
          <a class="page-link" href="#" tabindex="-1">Anterior</a>
        </li>
        {{end}}

        {{range $i := sequence 1 .Pagination.TotalPages}}
        {{if eq $i $.Pagination.CurrentPage}}
        <li class="page-item active">
          <a class="page-link" href="/transactions?page={{$i}}">{{$i}}</a>
        </li>
        {{else}}
          <li class="page-item">
            <a class="page-link" href="/transactions?page={{$i}}">{{$i}}</a>
          </li>
          {{end}}
          {{end}}

          {{if .Pagination.HasNext}}
          <li class="page-item">
            <a class="page-link" href="/transactions?page={{.Pagination.NextPage}}">Próxima</a>
          </li>
          {{else}}
            <li class="page-item disabled">
              <a class="page-link" href="#" tabindex="-1">Próxima</a>
            </li>
            {{end}}
    </ul>
  </nav>
  {{end}}

  {{else}}
    <div class="card">
      <div class="card-body text-center py-5">
        <i data-feather="credit-card" class="text-muted mb-3" style="width: 48px; height: 48px;"></i>
        <h4>Nenhuma transação encontrada</h4>
        <p class="text-muted">
          Suas transações aparecerão aqui quando você fizer vendas através do Stripe Connect.
          Certifique-se de que sua conta está configurada corretamente.
        </p>
        <a href="/stripe-connect/status" class="btn btn-primary">
          <i data-feather="settings"></i> Configurar Stripe Connect
        </a>
      </div>
    </div>
    {{end}}
</main>
</div>
</div>

{{ end }}