{{ define "title" }} Detalhes da Transação {{ end }}
{{ define "content" }}
<!-- Container fluid -->
<div class="container-fluid p-6">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-12">
      <!-- Page header -->
      <div class="border-bottom pb-4 mb-4">
        <div class="row align-items-center">
          <div class="col">
            <h3 class="mb-0 fw-bold">Detalhes da Transação #{{.Transaction.ID}}</h3>
            <p class="mb-0 text-muted">Informações completas sobre a transação processada</p>
          </div>
          <div class="col-auto">
            <div class="d-flex gap-2">
              <a href="/transactions" class="btn btn-outline-secondary">
                <i class="mdi mdi-chevron-left icon-xs me-2"></i>
                Voltar
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!-- content -->
  <div class="py-6">
    <!-- Status Card -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card bg-light-subtle border-0">
          <div class="card-body text-center py-4">
            <div class="d-flex align-items-center justify-content-center mb-3">
              {{ if eq .Transaction.Status "completed" }}
              <div class="avatar avatar-lg bg-success-subtle text-success me-3">
                <i class="mdi mdi-check-circle" style="font-size: 1.5rem;"></i>
              </div>
              <div class="text-start">
                <h4 class="mb-1 text-success">Transação Concluída</h4>
                <p class="mb-0 text-muted">Processada em {{.Transaction.ProcessedAt.Format "02/01/2006 às 15:04:05"}}</p>
              </div>
              {{ else if eq .Transaction.Status "pending" }}
              <div class="avatar avatar-lg bg-warning-subtle text-warning me-3">
                <i class="mdi mdi-clock" style="font-size: 1.5rem;"></i>
              </div>
              <div class="text-start">
                <h4 class="mb-1 text-warning">Transação Pendente</h4>
                <p class="mb-0 text-muted">Aguardando processamento</p>
              </div>
              {{ else }}
              <div class="avatar avatar-lg bg-danger-subtle text-danger me-3">
                <i class="mdi mdi-close-circle" style="font-size: 1.5rem;"></i>
              </div>
              <div class="text-start">
                <h4 class="mb-1 text-danger">Transação com Falha</h4>
                <p class="mb-0 text-muted">{{.Transaction.ErrorMessage}}</p>
              </div>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cards de Estatísticas Financeiras -->
    <div class="row mb-4">
      <div class="col-12">
        <div class="card border-0 shadow-sm mb-3 bg-light">
          <div class="card-body">
            <h6 class="card-title mb-3 d-flex align-items-center text-dark">
              <div class="avatar-sm rounded-circle bg-success d-flex align-items-center justify-content-center me-2">
                <i class="mdi mdi-chart-line text-white"></i>
              </div>
              Resumo Financeiro
            </h6>
            <div class="row g-3">
              <div class="col-6 col-md-3">
                <div class="text-center p-3 rounded border bg-white" 
                     style="min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                  <h4 class="mb-1 text-primary fw-bold">{{.Transaction.GetFormattedTotalAmount}}</h4>
                  <small class="text-muted fw-medium">Valor Total</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="text-center p-3 rounded border bg-white" 
                     style="min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                  <h4 class="mb-1 text-success fw-bold">{{.Transaction.GetFormattedCreatorAmount}}</h4>
                  <small class="text-muted fw-medium">Seu Ganho</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="text-center p-3 rounded border bg-white" 
                     style="min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                  <h4 class="mb-1 text-warning fw-bold">{{.Transaction.GetFormattedPlatformAmount}}</h4>
                  <small class="text-muted fw-medium">Taxa Plataforma</small>
                </div>
              </div>
              <div class="col-6 col-md-3">
                <div class="text-center p-3 rounded border bg-white" 
                     style="min-height: 80px; display: flex; flex-direction: column; justify-content: center;">
                  <h4 class="mb-1 text-info fw-bold">{{.Transaction.GetFormattedProcessingFee}}</h4>
                  <small class="text-muted fw-medium">Taxa Stripe</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- row  -->
    <div class="row">
      <!-- Informações da Transação -->
      <div class="col-xl-6 col-lg-6 col-md-12 col-12 mb-4">
        <div class="card h-100">
          <div class="card-header bg-white py-4">
            <h5 class="mb-0 fw-semi-bold">
              <i class="mdi mdi-information icon-xs me-2"></i>
              Informações da Transação
            </h5>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">ID da Transação</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 fw-semi-bold">{{.Transaction.ID}}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Data de Criação</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0">{{.Transaction.CreatedAt.Format "02/01/2006 às 15:04:05"}}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Status</label>
              </div>
              <div class="col-sm-7">
                {{ if eq .Transaction.Status "completed" }}
                <span class="badge bg-success-subtle text-success">
                  <i class="mdi mdi-check-circle icon-xs me-1"></i>
                  Concluída
                </span>
                {{ else if eq .Transaction.Status "pending" }}
                <span class="badge bg-warning-subtle text-warning">
                  <i class="mdi mdi-clock icon-xs me-1"></i>
                  Pendente
                </span>
                {{ else }}
                <span class="badge bg-danger-subtle text-danger">
                  <i class="mdi mdi-close-circle icon-xs me-1"></i>
                  Falha
                </span>
                {{ end }}
              </div>
            </div>
            {{if .Transaction.ProcessedAt}}
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Processada em</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0">{{.Transaction.ProcessedAt.Format "02/01/2006 às 15:04:05"}}</p>
              </div>
            </div>
            {{end}}
          </div>
        </div>
      </div>

      <!-- Detalhes Financeiros -->
      <div class="col-xl-6 col-lg-6 col-md-12 col-12 mb-4">
        <div class="card h-100">
          <div class="card-header bg-white py-4">
            <h5 class="mb-0 fw-semi-bold">
              <i class="mdi mdi-cash icon-xs me-2"></i>
              Detalhes Financeiros
            </h5>
          </div>
          <div class="card-body">
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Valor Total</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 fw-bold text-primary fs-5">{{.Transaction.GetFormattedTotalAmount}}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Taxa do Stripe</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 text-danger">- {{.Transaction.GetFormattedProcessingFee}}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Comissão da Plataforma</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 text-danger">- {{.Transaction.GetFormattedPlatformAmount}}</p>
              </div>
            </div>
            <hr class="my-3">
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-bold text-muted">Seu Ganho</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 fw-bold text-success fs-5">{{.Transaction.GetFormattedCreatorAmount}}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Tipo de Split</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0">
                  {{if eq .Transaction.SplitType "percentage"}}
                  <span class="badge bg-info-subtle text-info">
                    Percentual ({{printf "%.0f" (mul .Transaction.PlatformPercentage 100)}}%)
                  </span>
                  {{else}}
                    <span class="badge bg-info-subtle text-info">
                      Valor Fixo (R$ {{div .Transaction.PlatformFixedFee 100}})
                    </span>
                    {{end}}
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="row">
      <!-- Produto Vendido -->
      <div class="col-xl-6 col-lg-6 col-md-12 col-12 mb-4">
        <div class="card h-100">
          <div class="card-header bg-white py-4">
            <h5 class="mb-0 fw-semi-bold">
              <i class="mdi mdi-book-open icon-xs me-2"></i>
              Produto Vendido
            </h5>
          </div>
          <div class="card-body">
            <div class="d-flex align-items-center mb-3">
              <div class="avatar avatar-lg me-3">
                <div class="avatar-content bg-primary">
                  <i class="mdi mdi-book-open text-white" style="font-size: 1.2rem;"></i>
                </div>
              </div>
              <div>
                <h5 class="mb-1">{{.Transaction.Purchase.Ebook.Title}}</h5>
                <p class="mb-0 text-muted">Ebook Digital</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Preço de Venda</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 fw-semi-bold">{{.Transaction.Purchase.Ebook.GetValue}}</p>
              </div>
            </div>
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">ID da Compra</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 font-monospace">{{.Transaction.Purchase.ID}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Identificadores Stripe -->
      <div class="col-xl-6 col-lg-6 col-md-12 col-12 mb-4">
        <div class="card h-100">
          <div class="card-header bg-white py-4">
            <h5 class="mb-0 fw-semi-bold">
              <i class="mdi mdi-credit-card icon-xs me-2"></i>
              Identificadores Stripe
            </h5>
          </div>
          <div class="card-body">
            {{if .Transaction.StripePaymentIntentID}}
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Payment Intent</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 font-monospace text-break">{{.Transaction.StripePaymentIntentID}}</p>
              </div>
            </div>
            {{end}}
            {{if .Transaction.StripeTransferID}}
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Transfer ID</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 font-monospace text-break">{{.Transaction.StripeTransferID}}</p>
              </div>
            </div>
            {{end}}
            <div class="row mb-3">
              <div class="col-sm-5">
                <label class="form-label fw-semi-bold text-muted">Conta Connect</label>
              </div>
              <div class="col-sm-7">
                <p class="mb-0 font-monospace text-break">{{.Creator.StripeConnectAccountID}}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{{end}}