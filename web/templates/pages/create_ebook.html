{{ define "title" }} Ebooks {{ end }}
{{ define "content" }}
<!-- Container fluid -->
<div class="container-fluid p-6">
  <div class="row">
    <div class="col-lg-12 col-md-12 col-12">
      <!-- Page header -->
      <div class="border-bottom pb-4 mb-4 ">
        <h3 class="mb-0 fw-bold">Cadastro de Ebook</h3>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-lg-12 col-md-12 col-12">
      <div class="card">
        <div class="card-body">
          <form id="ebook-form" action="/ebook/create" method="POST" enctype="multipart/form-data">
            <div class="mb-3">
              <label for="ebookTitle" class="form-label">Título do Ebook</label>
              <input type="text" class="form-control" id="ebookTitle" name="title"
                placeholder="Digite o título do ebook" required value="{{.Form.Title}}">
              {{with .Errors.Title}}<p class="text-danger">{{.}}</p>{{end}}
            </div>
            <div class="mb-3">
              <label for="ebookDescription" class="form-label">Descrição</label>
              <textarea class="form-control" id="ebookDescription" name="description" rows="3"
                placeholder="Digite a descrição do ebook" required>{{.Form.Description}}</textarea>
              {{with .Errors.Description}}<p class="text-danger">{{.}}</p>{{end}}
            </div>
            <div class="mb-3">
              <label for="ebookPrice" class="form-label">Valor</label>
              <input type="text" class="form-control" id="ebookPrice" name="value" placeholder="Digite o valor do ebook"
                maxlength="15" max="100000" required value="{{.Form.Value}}">
              <script>
                const priceInput = document.getElementById('ebookPrice');

                priceInput.addEventListener('input', () => {
                  let value = priceInput.value.replace(/\D/g, '');
                  value = (value / 100).toFixed(2).replace('.', ',');
                  value = value.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                  priceInput.value = `R$ ${value}`;
                });

                const form = document.getElementById("ebook-form")
                form.onsubmit(e => {
                  e.preventDefault
                  console.log("Prevent default")
                })
              </script>
              {{with .Errors.Value}}<p class="text-danger">{{.}}</p>{{end}}
            </div>
            <div class="mb-3">
              <label for="ebookFile" class="form-label">Arquivo do Ebook</label>
              <div id="ebookFileDropzone" class="dropzone border border-dashed p-3 text-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="50" height="50" fill="currentColor"
                  class="bi bi-file-earmark-pdf mb-2" viewBox="0 0 16 16">
                  <path d="M5.5 6a.5.5 0 0 1 .5-.5h1.5v1H6v1h1v1H6a.5.5 0 0 1-.5-.5V6z" />
                  <path d="M9 6.5H8v3h1a1.5 1.5 0 0 0 0-3zM8.5 8v-1h.5a.5.5 0 0 1 0 1h-.5z" />
                  <path
                    d="M14 4.5V14a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h5.5L14 4.5zM13 5H9.5a.5.5 0 0 1-.5-.5V1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V5z" />
                </svg>
                <p>Arraste e solte o arquivo aqui ou clique para selecionar</p>
              </div>
              <input type="file" class="form-control d-none" id="ebookFile" name="file" accept=".pdf,.epub" required>
              <p id="selectedFileName" class="mt-2 fw-bold"></p>
              {{with .Errors.File}}<p class="text-danger">{{.}}</p>{{end}}
            </div>
            <script>
              const dropzone = document.getElementById('ebookFileDropzone');
              const fileInput = document.getElementById('ebookFile');

              dropzone.addEventListener('click', () => fileInput.click());

              dropzone.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropzone.classList.add('bg-light');
              });

              dropzone.addEventListener('dragleave', () => {
                dropzone.classList.remove('bg-light');
              });

              dropzone.addEventListener('drop', (e) => {
                e.preventDefault();
                dropzone.classList.remove('bg-light');
                if (e.dataTransfer.files.length) {
                  fileInput.files = e.dataTransfer.files;
                }
              });

              const selectedFileName = document.getElementById('selectedFileName');


              fileInput.addEventListener('change', () => {
                if (fileInput.files.length > 0) {
                  selectedFileName.textContent = `Arquivo selecionado: ${fileInput.files[0].name}`;
                } else {
                  selectedFileName.textContent = '';
                }
              });
            </script>
            <button type="submit" class="btn btn-primary">Cadastrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
{{end}}